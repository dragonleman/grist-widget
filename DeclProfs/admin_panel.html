<!DOCTYPE html>
<html>
<head>
  	<meta charset="utf-8">
  	<title>Activities Declaration</title>
  	<link rel="stylesheet" href="https://web2018.epfl.ch/8.3.0/css/elements.min.css">
  	<link rel="stylesheet" href="css/declprofs.css">
	<script src="https://web2018.epfl.ch/8.3.0/js/elements.min.js"></script>
</head>
<body>
  	<header class="header header-light my-2">
		<div class="header-light-content">
			<a class="logo" href="https://www.epfl.ch"><img src="img/epfl_small.png" alt="Logo EPFL" class="img-fluid"></a>
			<p class="site-title"><a href="#">Professor outside activities</a></p>
			<nav class="nav-lang nav-lang-short ml-auto pr-lg-5"></nav>
		</div>
  	</header>

	<div class="breadcrumb-container pb-0 mb-0">
		<nav aria-label="breadcrumb" class="breadcrumb-wrapper" id="breadcrumb-wrapper"></nav>
	</div>

  	<div class="main-container m-4">
        <h3>Admin panel</h3>

        <hr>

        <h5>Exceptions</h5>

        <div class="container">
            <div class="row">
                <div class="col-sm">
                    <p>End date of exception</p>
                    <div class="datepicker-wrapper">
                        <input id="dateInput" type="text" class="datepicker">
                    </div>
                </div>
                <div class="col-sm">
                    <div class="custom-control custom-switch">
                        <input id="exceptionSwitch" type="checkbox" class="custom-control-input" style="width: 200px">
                        <label class="custom-control-label" for="exceptionSwitch">Exception</label>
                    </div>
                </div>
                <div class="col-sm">
                </div>
            </div>
        </div>

		<hr>

        <h5>Send emails</h5>

        <div class="container">
            <div class="row">
                <div class="col-sm">
                </div>
                <div class="col-sm">
                    <button id="sendmailButton" class="btn btn-primary">Send emails</button>
                </div>
                <div class="col-sm">
                </div>
            </div>
        </div>    
	</div>

	<script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
	<script>
		const dateInput = document.getElementById('dateInput');
        const excBtn = document.getElementById('exceptionSwitch');
        const sendmailBtn = document.getElementById('sendmailButton');

		window.grist.ready({ requiredAccess: 'full' });

		window.grist.onRecords(records => {
            const rec = records[0];

            // Exception (Switch)
            excBtn.checked = Boolean(rec.exception);

            excBtn.addEventListener('change', async () => {
                await window.grist.selectedTable.update({
                    id: rec.id,
                    fields: { exception: excBtn.checked }
                });
            });

            // Send Emails
            sendmailBtn.addEventListener('click', async () => {
                await window.grist.selectedTable.update({
                    id: rec.id,
                    fields: { SendEmails: true }
                });
            });
        });
	</script>
	</script>

	<script>
    svgPath = 'https://web2018.epfl.ch/8.3.0/icons/icons.svg';
    featherSvgPath = 'https://web2018.epfl.ch/8.3.0/icons/feather-sprite.svg';
  </script>
</body>
</html>


